
#include <stddef.h>
#include <stdlib.h>
#include <string.h>
#include <assert.h>
#include <errno.h>

#include "barefootc/datetime.h"
#include "log4stdc.h"

static l4sc_logger_ptr_t logger;

void
t1(const char *start, const char *stop, long expected)
{
	long msecs;
	bfc_datetime_t t0, t1;

	bfc_init_datetime_from_isotime(&t0, sizeof(t0), start, strlen(start));
	bfc_init_datetime_from_isotime(&t1, sizeof(t1), stop,  strlen(stop));

	msecs = bfc_datetime_msecs_between(&t0, &t1);

	L4SC_DEBUG(logger, "%s: %s to %s: %ld, expected %ld",
			__FUNCTION__, start, stop, msecs, expected);

	assert (msecs == expected);
}

int
main (int argc, char *argv)
{
	int i, j;
	char buf[100];

	l4sc_configure_from_xml_file("log4j.xml");
	logger = l4sc_get_logger(BFC_DATETIME_LOGGER);

	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:00.0Z",           0L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:01.0Z",        1000L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:02.0Z",        2000L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:35:02.0Z",     2102000L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:59.0Z",       -1000L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:58.0Z",       -2000L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:24:58.0Z",    -2102000L);

	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:00.1Z",         100L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:01.1Z",        1100L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:02.1Z",        2100L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:35:02.1Z",     2102100L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:59.1Z",        -900L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:58.1Z",       -1900L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:24:58.1Z",    -2101900L);

	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:00.2Z",         200L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:01.2Z",        1200L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:35:02.2Z",     2102200L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:59.2Z",        -800L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:58.2Z",       -1800L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:24:58.2Z",    -2101800L);

	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:00.7Z",         700L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:01.7Z",        1700L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:35:02.7Z",     2102700L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:59.7Z",        -300L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:58.7Z",       -1300L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:24:58.7Z",    -2101300L);

	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:00.9Z",         900L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:01.9Z",        1900L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:35:02.9Z",     2102900L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:59.9Z",        -100L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:59:58.9Z",       -1100L);
	t1("2014-01-01T12:00:00Z", "2014-01-01T11:24:58.9Z",    -2101100L);

	t1("2014-01-01T11:59:59.8Z", "2014-01-01T12:00:00.7Z",         900L);
	t1("2014-01-01T11:59:59.8Z", "2014-01-01T12:00:01.7Z",        1900L);
	t1("2014-01-01T11:59:59.8Z", "2014-01-01T12:35:02.7Z",     2102900L);
	t1("2014-01-01T11:59:59.8Z", "2014-01-01T11:59:59.7Z",        -100L);
	t1("2014-01-01T11:59:59.8Z", "2014-01-01T11:59:58.7Z",       -1100L);
	t1("2014-01-01T11:59:59.8Z", "2014-01-01T11:24:58.7Z",    -2101100L);

	t1("2014-01-01T23:59:59.8Z", "2014-01-02T00:00:00.7Z",         900L);
	t1("2014-01-01T23:59:59.8Z", "2014-01-02T00:00:01.7Z",        1900L);
	t1("2014-01-01T23:59:59.8Z", "2014-01-02T00:35:02.7Z",     2102900L);
	t1("2014-01-02T00:00:00.8Z", "2014-01-01T23:59:59.7Z",       -1100L);
	t1("2014-01-02T00:00:00.8Z", "2014-01-01T23:59:58.7Z",       -2100L);
	t1("2014-01-02T00:00:00.8Z", "2014-01-01T23:24:58.7Z",    -2102100L);

	if (sizeof(long) > 4) {
	t1("2014-01-01T11:59:30.8Z", "2015-01-01T12:00:00.7Z", 315360299L*100L);
	t1("2014-01-01T11:59:30.8Z", "2015-01-01T12:00:01.7Z", 315360309L*100L);
	t1("2014-01-01T11:59:30.8Z", "2015-01-01T12:00:02.7Z", 315360319L*100L);
	t1("2014-01-01T11:59:30.8Z", "2013-01-01T11:58:59.7Z",-315360311L*100L);
	}

	return (0);
}
