
#include <stddef.h>
#include <stdlib.h>
#include <string.h>
#include <assert.h>
#include <errno.h>

#include "barefootc/datetime.h"
#include "log4stdc.h"

static l4sc_logger_ptr_t logger;

void
t1(const char *start, const char *stop, long expected)
{
	long secs;
	bfc_datetime_t t0, t1;

	bfc_init_datetime_from_isotime(&t0, sizeof(t0), start, strlen(start));
	bfc_init_datetime_from_isotime(&t1, sizeof(t1), stop,  strlen(stop));

	secs = bfc_datetime_secs_between(&t0, &t1);

	L4SC_DEBUG(logger, "%s: %s to %s: %ld, expected %ld",
				__FUNCTION__, start, stop, secs, expected);

	assert (secs == expected);
}

#define ONEDAY	((int32_t) 24 * 3600)

int
main (int argc, char *argv[])
{
	int i, j;
	char buf[100];

	l4sc_configure_from_xml_file("log4j.xml");
	logger = l4sc_get_logger(BFC_DATETIME_LOGGER);

	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:00Z", 0);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:01Z", 1);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:00:09Z", 9);
	t1("2014-01-01T12:00:00Z", "2014-01-01T12:01:09Z", 69);
	t1("2014-01-01T12:00:00Z", "2014-01-01T13:01:09Z", 3669);

	t1("2014-01-01T12:00:00Z", "2014-01-02T12:00:00Z", ONEDAY+0);
	t1("2014-01-01T12:00:00Z", "2014-01-02T12:00:01Z", ONEDAY+1);
	t1("2014-01-01T12:00:00Z", "2014-01-02T12:00:09Z", ONEDAY+9);
	t1("2014-01-01T12:00:00Z", "2014-01-02T12:01:09Z", ONEDAY+69);
	t1("2014-01-01T12:00:00Z", "2014-01-02T13:01:09Z", ONEDAY+3669);
	t1("2014-01-01T12:00:00Z", "2014-01-02T11:59:59Z", ONEDAY-1);

	t1("2014-01-01T12:00:00Z", "2014-02-01T12:00:00Z", 31*ONEDAY+0);
	t1("2014-01-01T12:00:00Z", "2014-02-01T12:00:01Z", 31*ONEDAY+1);
	t1("2014-01-01T12:00:00Z", "2014-02-01T12:00:09Z", 31*ONEDAY+9);
	t1("2014-01-01T12:00:00Z", "2014-02-01T12:01:09Z", 31*ONEDAY+69);
	t1("2014-01-01T12:00:00Z", "2014-02-01T13:01:09Z", 31*ONEDAY+3669);
	t1("2014-01-01T12:00:00Z", "2014-02-01T11:59:59Z", 31*ONEDAY-1);

	t1("2014-01-01T12:00:00Z", "2014-12-01T12:00:00Z", 334*ONEDAY+0);
	t1("2014-01-01T12:00:00Z", "2014-12-01T12:00:01Z", 334*ONEDAY+1);
	t1("2014-01-01T12:00:00Z", "2014-12-01T12:00:09Z", 334*ONEDAY+9);
	t1("2014-01-01T12:00:00Z", "2014-12-01T12:01:09Z", 334*ONEDAY+69);
	t1("2014-01-01T12:00:00Z", "2014-12-01T13:01:09Z", 334*ONEDAY+3669);
	t1("2014-01-01T12:00:00Z", "2014-12-01T11:59:59Z", 334*ONEDAY-1);

	t1("2014-01-01T12:00:00Z", "2015-01-01T12:00:00Z", 365*ONEDAY+0);
	t1("2014-01-01T12:00:00Z", "2015-01-01T12:00:01Z", 365*ONEDAY+1);
	t1("2014-01-01T12:00:00Z", "2015-01-01T12:00:09Z", 365*ONEDAY+9);
	t1("2014-01-01T12:00:00Z", "2015-01-01T12:01:09Z", 365*ONEDAY+69);
	t1("2014-01-01T12:00:00Z", "2015-01-01T13:01:09Z", 365*ONEDAY+3669);
	t1("2014-01-01T12:00:00Z", "2015-01-01T11:59:59Z", 365*ONEDAY-1);

	t1("2014-01-01T12:00:00Z", "2019-01-01T12:00:00Z", 1826*ONEDAY+0);
	t1("2014-01-01T12:00:00Z", "2019-01-01T12:00:01Z", 1826*ONEDAY+1);
	t1("2014-01-01T12:00:00Z", "2019-01-01T12:00:09Z", 1826*ONEDAY+9);
	t1("2014-01-01T12:00:00Z", "2019-01-01T12:01:09Z", 1826*ONEDAY+69);
	t1("2014-01-01T12:00:00Z", "2019-01-01T13:01:09Z", 1826*ONEDAY+3669);
	t1("2014-01-01T12:00:00Z", "2019-01-01T11:59:59Z", 1826*ONEDAY-1);

	t1("1970-01-01T00:00:00Z", "2038-01-01T00:00:00Z", 24837*ONEDAY+0);
	t1("1970-01-01T00:00:00Z", "2038-01-01T00:00:01Z", 24837*ONEDAY+1);
	t1("1970-01-01T00:00:00Z", "2038-01-01T00:00:09Z", 24837*ONEDAY+9);
	t1("1970-01-01T00:00:00Z", "2038-01-01T00:01:09Z", 24837*ONEDAY+69);
	t1("1970-01-01T00:00:00Z", "2038-01-01T01:01:09Z", 24837*ONEDAY+3669);
	t1("1970-01-01T00:00:00Z", "2037-12-31T23:59:59Z", 24837*ONEDAY-1);

	t1("2035-01-01T12:00:00Z", "2040-01-01T12:00:00Z", 1826*ONEDAY+0);
	t1("2035-01-01T12:00:00Z", "2040-01-01T12:00:01Z", 1826*ONEDAY+1);
	t1("2035-01-01T12:00:00Z", "2040-01-01T12:00:09Z", 1826*ONEDAY+9);
	t1("2035-01-01T12:00:00Z", "2040-01-01T12:01:09Z", 1826*ONEDAY+69);
	t1("2035-01-01T12:00:00Z", "2040-01-01T13:01:09Z", 1826*ONEDAY+3669);
	t1("2035-01-01T12:00:00Z", "2040-01-01T11:59:59Z", 1826*ONEDAY-1);

	t1("1966-01-01T12:00:00Z", "1971-01-01T12:00:00Z", 1826*ONEDAY+0);
	t1("1966-01-01T12:00:00Z", "1971-01-01T12:00:01Z", 1826*ONEDAY+1);
	t1("1966-01-01T12:00:00Z", "1971-01-01T12:00:09Z", 1826*ONEDAY+9);
	t1("1966-01-01T12:00:00Z", "1971-01-01T12:01:09Z", 1826*ONEDAY+69);
	t1("1966-01-01T12:00:00Z", "1971-01-01T13:01:09Z", 1826*ONEDAY+3669);
	t1("1966-01-01T12:00:00Z", "1971-01-01T11:59:59Z", 1826*ONEDAY-1);

	t1("1970-01-01T00:00:00Z", "1902-01-01T00:00:00Z", -24837*ONEDAY+0);
	t1("1970-01-01T00:00:00Z", "1902-01-01T00:00:01Z", -24837*ONEDAY+1);
	t1("1970-01-01T00:00:00Z", "1902-01-01T00:00:09Z", -24837*ONEDAY+9);
	t1("1970-01-01T00:00:00Z", "1902-01-01T00:01:09Z", -24837*ONEDAY+69);
	t1("1970-01-01T00:00:00Z", "1902-01-01T01:01:09Z", -24837*ONEDAY+3669);
	t1("1970-01-01T00:00:00Z", "1901-12-31T23:59:59Z", -24837*ONEDAY-1);

	/* Hint: 1900 had no Feb 29th, so only one extra day (in 1904) */
	t1("1905-01-01T12:00:00Z", "1900-01-01T12:00:00Z", -1826*ONEDAY+0);
	t1("1905-01-01T12:00:00Z", "1900-01-01T12:00:01Z", -1826*ONEDAY+1);
	t1("1905-01-01T12:00:00Z", "1900-01-01T12:00:09Z", -1826*ONEDAY+9);
	t1("1905-01-01T12:00:00Z", "1900-01-01T12:01:09Z", -1826*ONEDAY+69);
	t1("1905-01-01T12:00:00Z", "1900-01-01T13:01:09Z", -1826*ONEDAY+3669);
	t1("1905-01-01T12:00:00Z", "1900-01-01T11:59:59Z", -1826*ONEDAY-1);

	if (sizeof(long) > 4) {
	t1("1901-01-01T12:00:00Z", "2097-01-01T12:00:00Z", 71589L*ONEDAY+0);
	t1("1901-01-01T12:00:00Z", "2097-01-01T12:00:01Z", 71589L*ONEDAY+1);
	t1("1901-01-01T12:00:00Z", "2097-01-01T12:00:09Z", 71589L*ONEDAY+9);
	t1("1901-01-01T12:00:00Z", "2097-01-01T12:01:09Z", 71589L*ONEDAY+69);
	t1("1901-01-01T12:00:00Z", "2097-01-01T13:01:09Z", 71589L*ONEDAY+3669);
	t1("1901-01-01T12:00:00Z", "2097-01-01T11:59:59Z", 71589L*ONEDAY-1);
	}

	return (0);
}
